<%- include('partials/header') %>

<div class="container" style="min-height: 60vh; padding: 50px 20px;">
    
    <% if (user.role === 'pro') { %>
        <h1 class="section-title">Mes Devis <span>Professionnels</span></h1>
        <p>Suivez l'Ã©tat de vos demandes de groupe et devis personnalisÃ©s.</p>
    <% } else { %>
        <h1 class="section-title">Mes Voyages <span>& Souhaits</span></h1>
        <p>Retrouvez ici vos prochaines aventures et vos demandes en attente.</p>
    <% } %>

    <a href="/mon-compte" style="display:inline-block; margin-bottom: 30px; color: #666; text-decoration: none;">â† Retour au tableau de bord</a>

    <% if(success_msg != '') { %>
        <div class="alert alert-success" style="margin-bottom: 20px;">âœ… <%= success_msg %></div>
    <% } %>

    <% if (orders.length === 0) { %>
        <div style="text-align: center; padding: 60px; background: white; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05);">
            <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ§³</div>
            <h3>C'est bien vide ici...</h3>
            <p>Vous n'avez pas encore planifiÃ© de voyage.</p>
            <a href="/destinations" class="btn-login" style="margin-top: 20px; display:inline-block;">Explorer le catalogue</a>
        </div>
    <% } else { %>

        <div style="display: flex; flex-direction: column; gap: 20px;">
            <% orders.forEach(order => { %>
                
                <div class="card" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 25px; border-left: 5px solid var(--primary);">
                    
                    <div style="flex: 2; min-width: 250px;">
                        <h3 style="margin: 0; color: var(--secondary); font-size: 1.4rem;">
                            <%= order.tripTitle %>
                        </h3>
                        
                        <div style="color: #666; margin-top: 10px; font-size: 0.9rem;">
                            ğŸ“… DemandÃ© le : <strong><%= order.createdAt.toLocaleDateString() %></strong> <br>
                            ğŸ‘¥ Voyageurs : <strong><%= order.nbPeople %></strong>
                            
                            <% if(user.role === 'pro') { %>
                                <span style="background: #e3f2fd; color: var(--secondary); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-left: 10px;">ğŸ¢ Tarif Pro</span>
                            <% } %>
                        </div>

                        <% if(order.options.length > 0) { %>
                            <div style="margin-top: 10px; font-size: 0.85rem; color: #555;">
                                â• <em><%= order.options.join(', ') %></em>
                            </div>
                        <% } %>

                        <% if(order.customMessage) { %>
                            <div style="margin-top: 10px; background: #fff3cd; padding: 8px; border-radius: 5px; font-size: 0.85rem; display: inline-block;">
                                ğŸ’¬ Note : "<%= order.customMessage %>"
                            </div>
                        <% } %>
                    </div>

                    <div style="flex: 1; text-align: right; min-width: 200px; margin-top: 10px;">
                        
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary); margin-bottom: 10px;">
                            <%= order.totalPrice.toLocaleString() %>â‚¬
                        </div>

                        <% 
                            let badgeColor = '#ffc107'; // Jaune (En attente)
                            let badgeText = order.status;
                            let badgeIcon = 'â³';

                            if(order.status === 'ValidÃ©e') { badgeColor = '#28a745'; badgeIcon = 'âœ…'; } 
                            if(order.status === 'RefusÃ©e') { badgeColor = '#dc3545'; badgeIcon = 'âŒ'; }
                            if(order.status === 'PayÃ©e') { badgeColor = '#17a2b8'; badgeIcon = 'ğŸ’³'; }
                        %>
                        
                        <div style="display: inline-block; background: <%= badgeColor %>; color: white; padding: 8px 15px; border-radius: 30px; font-weight: bold; font-size: 0.9rem;">
                            <%= badgeIcon %> <%= badgeText %>
                        </div>

                        <% if(order.status === 'ValidÃ©e' || order.status === 'PayÃ©e') { %>
                            <div style="margin-top: 10px; font-size: 0.8rem; color: #888;">
                                Paiement : <%= order.paymentStatus %> (<%= order.paymentMethod %>)
                            </div>
                            <% } %>

                    </div>

                </div>
            <% }) %>
        </div>

    <% } %>
</div>

<%- include('partials/footer') %>