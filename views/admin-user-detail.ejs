<%- include('partials/header') %>

<div class="container" style="padding: 50px 20px;">

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h1>üë§ Fiche Client : <%= targetUser.name %></h1>
        <a href="/admin/users" class="btn-login" style="background: #666;">‚Üê Retour Liste</a>
    </div>

    <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 40px;">
        
        <div style="flex: 1; min-width: 300px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
            <h3 style="margin-top: 0; color: #555;">Coordonn√©es</h3>
            <p><strong>Email :</strong> <a href="mailto:<%= targetUser.email %>"><%= targetUser.email %></a></p>
            <p><strong>Inscrit le :</strong> <%= new Date(targetUser.createdAt).toLocaleDateString() %></p>
            <p><strong>Type :</strong> <%= targetUser.role === 'pro' ? 'üè¢ Professionnel' : 'üë§ Particulier' %></p>
            <% if(targetUser.company) { %>
                <p><strong>Soci√©t√© :</strong> <%= targetUser.company %> (SIRET: <%= targetUser.siret %>)</p>
            <% } %>
        </div>

        <div style="flex: 1; min-width: 300px; background: linear-gradient(135deg, #2c3e50 0%, #000000 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
            <h3 style="margin-top: 0; color: #f1c40f;">Statut Wonder Club</h3>
            
            <div style="display: flex; align-items: center; gap: 15px; margin-top: 20px;">
                <div style="font-size: 3rem;">üèÜ</div>
                <div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: <%= stats.badgeColor %>;">
                        <%= stats.level %>
                    </div>
                    <div style="opacity: 0.8;">
                        <%= stats.tripCount %> voyages valid√©s
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px; font-size: 0.9rem; opacity: 0.7;">
                Total d√©pens√© √† vie : <strong><%= stats.totalSpent %> ‚Ç¨</strong>
            </div>
        </div>

    </div>
    <h2 style="border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; color: #e1306c;">‚ù§Ô∏è Sa Wishlist (Int√©r√™ts)</h2>

    <% if (!targetUser.wishlist || targetUser.wishlist.length === 0) { %>
        <p style="color: #999; font-style: italic;">Ce client n'a aucun favori pour l'instant.</p>
    <% } else { %>
        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 40px;">
            <% targetUser.wishlist.forEach(trip => { %>
                <% if(trip && trip.titre) { %>
                    <div style="background: white; border: 1px solid #ddd; border-radius: 10px; padding: 10px; width: 200px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                        <img src="/img/<%= trip.image %>" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px; margin-bottom: 10px;">
                        <div style="font-weight: bold; font-size: 0.9rem;"><%= trip.titre %></div>
                        <div style="color: #27ae60; font-weight: bold;"><%= trip.prix %> ‚Ç¨</div>
                        <div style="font-size: 0.8rem; color: #666;"><%= trip.dateDepart %></div>
                    </div>
                <% } %>
            <% }) %>
        </div>
    <% } %>
    <h2 style="border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px;">Historique des Commandes</h2>
    
    <% if (orders.length === 0) { %>
        <p>Ce client n'a encore rien command√©.</p>
    <% } else { %>
        <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
            <thead style="background: #f8f9fa;">
                <tr>
                    <th style="padding: 10px; text-align: left;">Date</th>
                    <th style="padding: 10px; text-align: left;">Voyage</th>
                    <th style="padding: 10px; text-align: left;">Prix</th>
                    <th style="padding: 10px; text-align: left;">Statut</th>
                    <th style="padding: 10px; text-align: left;">Paiement</th>
                </tr>
            </thead>
            <tbody>
                <% orders.forEach(order => { %>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px; color: #666;"><%= new Date(order.createdAt).toLocaleDateString() %></td>
                        <td style="padding: 10px;">
                            <strong><%= order.tripTitle %></strong><br>
                            <small>N¬∞ <%= order.reservationNumber %></small>
                        </td>
                        <td style="padding: 10px; font-weight: bold;"><%= order.totalPrice %> ‚Ç¨</td>
                        <td style="padding: 10px;">
                            <% 
                                let color = 'gray';
                                if(order.status === 'Pay√©e') color = 'green';
                                if(order.status === 'Refus√©e') color = 'red';
                                if(order.status === 'En attente') color = 'orange';
                            %>
                            <span style="color: <%= color %>; font-weight: bold;"><%= order.status %></span>
                        </td>
                        <td style="padding: 10px;"><%= order.paymentMethod %></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>

</div>

<%- include('partials/footer') %>