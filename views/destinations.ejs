<%- include('partials/header') %>

<div class="destinations-hero">
    <h1>Explorez le Monde</h1>
    <p>Choisissez votre prochaine aventure parmi nos sÃ©jours exclusifs.</p>
</div>

<div class="container" style="padding: 50px 20px;">
    <% if (locals.searchQuery) { %>
        <div style="margin-bottom: 30px; padding: 15px; background: #e3f2fd; border-radius: 10px; color: var(--secondary);">
            ğŸ” RÃ©sultats de recherche pour : <strong>"<%= searchQuery %>"</strong>
            <a href="/destinations" style="float: right; text-decoration: none; color: var(--primary);">Voir tout le catalogue</a>
        </div>
    <% } %>

    <div class="filter-container">
        <button class="filter-btn active" onclick="filterTrips('all')">Tout voir</button>
        <button class="filter-btn" onclick="filterTrips('amerique')">ğŸ‡ºğŸ‡¸ AmÃ©rique</button>
        <button class="filter-btn" onclick="filterTrips('europe')">ğŸ‡ªğŸ‡º Europe</button>
        <button class="filter-btn" onclick="filterTrips('asie')">ğŸ‡¯ğŸ‡µ Asie</button>
    </div>

    <div class="destinations-grid">
        <% voyages.forEach(voyage => { %>
            
            <% 
                let region = 'all';
                let t = voyage.titre.toLowerCase();
                if(t.includes('usa') || t.includes('floride') || t.includes('california')) region = 'amerique';
                else if(t.includes('japon') || t.includes('chine')) region = 'asie';
                else region = 'europe';
            %>

            <a href="/sejour/<%= voyage._id %>" class="trip-card link-reset" data-region="<%= region %>">
                <div class="trip-img" style="background-image: url('/img/<%= voyage.img %>');">
                    <span class="trip-price-badge">DÃ¨s <%= voyage.prixBase %>â‚¬</span>
                </div>
                <div class="trip-content">
                    <h3><%= voyage.titre %></h3>
                    <p><%= voyage.description.substring(0, 80) %>...</p> <div class="trip-footer">
                        <span style="color: var(--primary); font-weight: bold;">Voir le dÃ©tail â†’</span>
                    </div>
                </div>
            </a>

        <% }) %>
    </div>

    <div id="no-result" style="display:none; text-align:center; margin-top:50px;">
        <h3>Aucune destination trouvÃ©e dans cette catÃ©gorie.</h3>
    </div>

</div>

<script>
    function filterTrips(category) {
        const cards = document.querySelectorAll('.trip-card');
        const buttons = document.querySelectorAll('.filter-btn');
        let visibleCount = 0;

        // Gestion des boutons (visuel)
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // Filtrage des cartes
        cards.forEach(card => {
            if (category === 'all' || card.getAttribute('data-region') === category) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        // Message si vide
        const noResult = document.getElementById('no-result');
        if (visibleCount === 0) noResult.style.display = 'block';
        else noResult.style.display = 'none';
    }
</script>

<%- include('partials/footer') %>