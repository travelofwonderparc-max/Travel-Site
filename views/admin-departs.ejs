<%- include('partials/header') %>

<div class="container" style="padding: 50px 20px;">
    <h1>‚úàÔ∏è Gestion des D√©parts Group√©s</h1>
    
    <a href="/admin" class="btn-login" style="background:#666;">‚Üê Retour Admin</a>

    <div style="background: white; padding: 25px; border-radius: 15px; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
        <h3>‚ûï Programmer un nouveau d√©part</h3>
        <form action="/admin/departs/add" method="POST" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <input type="text" name="titre" placeholder="Titre (ex: Japon Automne)" required>
            <input type="text" name="image" placeholder="Image (ex: japon.jpg)" required>
            <input type="text" name="dateDepart" placeholder="Dates (ex: 12-24 Octobre 2026)" required>
            <input type="number" name="prix" placeholder="Prix (‚Ç¨)" required>
            <input type="number" name="capacity" placeholder="Nombre de places (Stock)" required>
            <textarea name="description" placeholder="Description rapide..." style="grid-column: span 2;"></textarea>
            <button type="submit" class="btn-login" style="grid-column: span 2;">Cr√©er le D√©part</button>
        </form>
    </div>

    <hr style="margin: 40px 0;">

    <div style="display: flex; flex-direction: column; gap: 20px;">
        <% trips.forEach(trip => { %>
            <div class="card" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 20px; border-left: 5px solid <%= trip.status === 'Complet' ? 'red' : 'green' %>;">
            <a href="/admin/departs/manage/<%= trip._id %>" class="btn-login">‚öôÔ∏è G√©rer</a>    
            <a href="/admin/departs/feature/<%= trip._id %>" class="btn-login" 
                       style="background: <%= trip.isFeatured ? '#f1c40f' : '#ccc' %>; color: <%= trip.isFeatured ? 'black' : 'white' %>; border: 1px solid #999;">
                        <%= trip.isFeatured ? '‚≠ê √Ä la Une' : '‚òÜ Mettre en Une' %>
                    </a>
                <div style="flex: 1;">
                    <h2 style="margin: 0;"><%= trip.titre %></h2>
                    <p style="color: #666;">üìÖ <%= trip.dateDepart %> | üí∞ <%= trip.prix %>‚Ç¨</p>
                    
                    <div style="background: #eee; height: 20px; width: 100%; max-width: 300px; border-radius: 10px; overflow: hidden; margin: 10px 0;">
                        <div style="background: <%= trip.status === 'Complet' ? 'red' : '#4caf50' %>; height: 100%; width: <%= (trip.filled / trip.capacity) * 100 %>%;"></div>
                    </div>
                    <p><strong><%= trip.filled %> / <%= trip.capacity %></strong> places occup√©es (<%= trip.status %>)</p>

                    <details>
                        <summary style="cursor: pointer; color: #007bff;">Voir les participants (<%= trip.participants.length %>)</summary>
                        <ul style="margin-top: 10px; font-size: 0.9rem;">
                            <% trip.participants.forEach(p => { %>
                                <li><%= p.name %> (<%= p.status %>)</li>
                            <% }) %>
                        </ul>
                    </details>
                </div>

                <div style="flex: 1; text-align: right; display: flex; flex-direction: column; align-items: flex-end; gap: 10px;">
                    
                    <% if(trip.status !== 'Complet') { %>
                        <form action="/admin/departs/add-participant/<%= trip._id %>" method="POST" style="display: flex; gap: 5px;">
                            <input type="text" name="name" placeholder="Nom du client" required style="padding: 5px;">
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 5px 10px; cursor: pointer;">+ Ajouter</button>
                        </form>
                    <% } else { %>
                        <button disabled style="background: #ccc; border: none; padding: 5px;">COMPLET</button>
                    <% } %>

                    <a href="/admin/departs/delete/<%= trip._id %>" onclick="return confirm('Supprimer ce voyage ?')" style="color: red; font-size: 0.9rem; margin-top: 10px;">üóëÔ∏è Supprimer le voyage</a>
                </div>

            </div>
        <% }) %>
    </div>
</div>

<%- include('partials/footer') %>